import{I as C,d as Y,r as i,R as re,e as u,c as h,o as _,b as e,w as a,F,p as R,q as $,h as x,M as ie,i as j,k as q,t as pe,K as N,a as ce,O as me,N as _e,z as fe,n as W,J as Z,v as X}from"./index-DuhZuMDA.js";const ge=(f,S,L)=>C.get(`/admin/product/${f}/${S}?category3Id=${L}`),ee=()=>C.get("/admin/product/baseTrademark/getTrademarkList"),te=f=>C.get(`/admin/product/spuImageList/${f}`),ae=f=>C.get(`/admin/product/spuSaleAttrList/${f}`),le=()=>C.get("/admin/product/baseSaleAttrList"),ve=f=>f.id?C.post("/admin/product/updateSpuInfo",f):C.post("/admin/product/saveSpuInfo",f),be=f=>C.post("/admin/product/saveSkuInfo",f),Se=f=>C.get(`/admin/product/findBySpuId/${f}`),ye=f=>C.delete(`/admin/product/deleteSpu/${f}`),Ve=["src"],ke=Y({__name:"spuform",emits:["changeScene"],setup(f,{expose:S,emit:L}){let P=L;const D=()=>{P("changeScene",0)},A=i([]),I=i([]),s=i([]),E=i([]),k=i(!1),U=i(""),y=i(""),r=i({category3Id:"",spuName:"",description:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),v=async t=>{r.value=t;let l=await ee(),m=await te(t.id),V=await ae(t.id),K=await le();l.code===200&&(A.value=l.data),m.code===200&&(I.value=m.data.map(w=>({name:w.imgName,url:w.imgUrl}))),V.code===200&&(s.value=V.data),K.code===200&&(E.value=K.data)},o=t=>{U.value=t.url,k.value=!0},c=()=>{},d=t=>t.type!=="image/jpeg"&&t.type!=="image/png"&&t.type!=="image/gif"?(N({type:"error",message:"请务必上传图片格式文件PNG/JPG/GIF"}),!1):t.size>10*1024*1024?(N({type:"error",message:"图片大小不能超过10M"}),!1):!0,T=re(()=>E.value.filter(l=>s.value.every(m=>l.name!==m.saleAttrName))),H=()=>{let[t,l]=y.value.split(":"),m={baseSaleAttrId:Number(t),saleAttrName:l,spuSaleAttrValueList:[]};s.value.push(m),y.value=""},z=t=>{t.flag=!0,t.saleAttrValue=""},p=t=>{const{baseSaleAttrId:l,saleAttrValue:m}=t;let V={baseSaleAttrId:l,saleAttrValueName:m};if(m?.trim()===""){N({type:"error",message:"属性值不能为空"});return}if(t.spuSaleAttrValueList.find(w=>w.saleAttrValueName===m)){N({type:"error",message:"属性值已存在"});return}t.spuSaleAttrValueList.push(V),t.flag=!1},g=async()=>{r.value.spuImageList=I.value.map(l=>({imgName:l.name,imgUrl:l.response&&l.response.data||l.url})),r.value.spuSaleAttrList=s.value,(await ve(r.value)).code===200?(N({type:"success",message:r.value.id?"修改成功":"添加成功"}),P("changeScene",0)):N({type:"error",message:r.value.id?"修改失败":"添加失败"})};return S({initHasSpuData:v,initAddSpuData:async t=>{Object.assign(r.value,{id:"",category3Id:"",spuName:"",description:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),s.value=[],I.value=[],y.value="",r.value.category3Id=t;let l=await ee();l.code===200&&(A.value=l.data);let m=await le();m.code===200&&(E.value=m.data)}}),(t,l)=>{const m=u("el-input"),V=u("el-form-item"),K=u("el-option"),w=u("el-select"),Q=u("Plus"),b=u("el-icon"),M=u("el-upload"),ne=u("el-dialog"),O=u("el-button"),J=u("el-table-column"),ue=u("el-tag"),oe=u("el-table"),se=u("el-form");return _(),h("div",null,[e(se,{"label-width":"100px","label-position":"left"},{default:a(()=>[e(V,{label:"SPU名称"},{default:a(()=>[e(m,{placeholder:"请输入SPU名称",modelValue:r.value.spuName,"onUpdate:modelValue":l[0]||(l[0]=n=>r.value.spuName=n)},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU品牌"},{default:a(()=>[e(w,{modelValue:r.value.tmId,"onUpdate:modelValue":l[1]||(l[1]=n=>r.value.tmId=n)},{default:a(()=>[(_(!0),h(F,null,R(A.value,n=>(_(),$(K,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU描述"},{default:a(()=>[e(m,{placeholder:"请输入SPU的描述",modelValue:r.value.description,"onUpdate:modelValue":l[2]||(l[2]=n=>r.value.description=n),type:"textarea"},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU图片"},{default:a(()=>[e(M,{"file-list":I.value,"onUpdate:fileList":l[3]||(l[3]=n=>I.value=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":o,"on-remove":c,headers:{token:x(ie)()},"before-upload":d},{default:a(()=>[e(b,null,{default:a(()=>[e(Q)]),_:1})]),_:1},8,["file-list","headers"]),e(ne,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=n=>k.value=n)},{default:a(()=>[j("img",{"w-full":"",src:U.value,alt:"预览图片",style:{width:"80%",height:"80%"}},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU销售属性"},{default:a(()=>[e(w,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=n=>y.value=n),placeholder:T.value.length?"请选择销售属性":"暂无可选属性"},{default:a(()=>[(_(!0),h(F,null,R(T.value,n=>(_(),$(K,{key:n.id,label:n.name,value:`${n.id}:${n.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(O,{disabled:!y.value,type:"primary",size:"default",icon:"Plus",onClick:H,style:{"margin-left":"10px"}},{default:a(()=>l[6]||(l[6]=[q("添加属性值")])),_:1,__:[6]},8,["disabled"]),e(oe,{data:s.value,border:"",style:{margin:"10px 0"}},{default:a(()=>[e(J,{type:"index",label:"序号",width:"80px"}),e(J,{prop:"saleAttrName",label:"销售属性名称",width:"120px"}),e(J,{prop:"value",label:"销售属性值"},{default:a(({row:n})=>[(_(!0),h(F,null,R(n.spuSaleAttrValueList,(B,de)=>(_(),$(ue,{key:B.id,class:"mx-1",closable:"",style:{margin:"0 5px"},onClose:()=>n.spuSaleAttrValueList.splice(de,1)},{default:a(()=>[q(pe(B.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag===!0?(_(),$(m,{key:0,modelValue:n.saleAttrValue,"onUpdate:modelValue":B=>n.saleAttrValue=B,placeholder:"请输入属性值",size:"small",style:{"margin-left":"10px",width:"100px"},onBlur:B=>p(n)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(_(),$(O,{key:1,type:"primary",size:"small",icon:"Plus",onClick:B=>z(n)},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"120px"},{default:a(({$index:n})=>[e(O,{type:"danger",size:"default",icon:"Delete",onClick:B=>s.value.splice(n,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(V,{label:""},{default:a(()=>[e(O,{disabled:r.value.spuName===""||r.value.description==="",type:"primary",onClick:g},{default:a(()=>l[7]||(l[7]=[q("保存")])),_:1,__:[7]},8,["disabled"]),e(O,{type:"default",onClick:D},{default:a(()=>l[8]||(l[8]=[q("取消")])),_:1,__:[8]})]),_:1})]),_:1})])}}}),Ie=["src"],Ae=Y({__name:"skuform",emits:["changeScene"],setup(f,{expose:S,emit:L}){const P=i(),D=i([]),A=i([]),I=i([]),s=ce({spuId:"",tmId:"",category3Id:"",skuName:"",price:"",weight:"",skuDesc:"",skuDefaultImg:"",skuAttrValueList:[],skuSaleAttrValueList:[]}),E=()=>{r("changeScene",0)},k=(v,o,c)=>{Object.assign(s,{spuId:"",tmId:"",category3Id:"",skuName:"",price:"",weight:"",skuDesc:"",skuDefaultImg:"",skuAttrValueList:[],skuSaleAttrValueList:[]}),s.spuId=c.id,s.tmId=c.tmId,s.category3Id=c.category3Id,me(v,o,c.category3Id).then(d=>{d.code===200&&(D.value=d.data)}),ae(c.id).then(d=>{d.code===200&&(A.value=d.data)}),te(c.id).then(d=>{d.code===200&&(I.value=d.data)})},U=v=>{I.value.forEach(o=>{P.value.toggleRowSelection(o,!1)}),P.value.toggleRowSelection(v,!0),s.skuDefaultImg=v.imgUrl},y=()=>{s.skuAttrValueList=D.value.reduce((v,o)=>{if(o.attrIdAndValueId){const[c,d]=o.attrIdAndValueId.split(":");v.push({attrId:Number(c),valueId:Number(d)})}return v},[]),s.skuSaleAttrValueList=A.value.reduce((v,o)=>{if(o.saleIdAndValueId){const[c,d]=o.saleIdAndValueId.split(":");v.push({saleAttrId:Number(c),saleAttrValueId:Number(d)})}return v},[]),be(s).then(v=>{v.code===200?N.success("添加SKU成功"):N.error("添加SKU失败"),r("changeScene",0)})};let r=L;return S({initSkuData:k}),(v,o)=>{const c=u("el-input"),d=u("el-form-item"),T=u("el-option"),H=u("el-select"),z=u("el-form"),p=u("el-table-column"),g=u("el-button"),G=u("el-table");return _(),h("div",null,[e(z,{"label-width":"100px","label-position":"left"},{default:a(()=>[e(d,{label:"SPU名称"},{default:a(()=>[e(c,{placeholder:"SPU名称",modelValue:s.skuName,"onUpdate:modelValue":o[0]||(o[0]=t=>s.skuName=t)},null,8,["modelValue"])]),_:1}),e(d,{label:"价格(元)"},{default:a(()=>[e(c,{placeholder:"价格(元)",type:"number",modelValue:s.price,"onUpdate:modelValue":o[1]||(o[1]=t=>s.price=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(d,{label:"重量(g)"},{default:a(()=>[e(c,{placeholder:"重量(g)",type:"number",modelValue:s.weight,"onUpdate:modelValue":o[2]||(o[2]=t=>s.weight=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(d,{label:"SKU描述"},{default:a(()=>[e(c,{placeholder:"SKU描述",type:"textarea",modelValue:s.skuDesc,"onUpdate:modelValue":o[3]||(o[3]=t=>s.skuDesc=t)},null,8,["modelValue"])]),_:1}),e(d,{label:"平台属性"},{default:a(()=>[e(z,{inline:"","label-width":"100px","label-position":"left"},{default:a(()=>[(_(!0),h(F,null,R(D.value,t=>(_(),$(d,{key:t.id,label:t.attrName},{default:a(()=>[e(H,{modelValue:t.attrIdAndValueId,"onUpdate:modelValue":l=>t.attrIdAndValueId=l},{default:a(()=>[(_(!0),h(F,null,R(t.attrValueList,l=>(_(),$(T,{key:l.id,label:l.valueName,value:`${t.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(d,{label:"销售属性"},{default:a(()=>[e(z,{inline:"","label-width":"100px","label-position":"left"},{default:a(()=>[(_(!0),h(F,null,R(A.value,t=>(_(),$(d,{key:t.id,label:t.saleAttrName},{default:a(()=>[e(H,{modelValue:t.saleIdAndValueId,"onUpdate:modelValue":l=>t.saleIdAndValueId=l},{default:a(()=>[(_(!0),h(F,null,R(t.spuSaleAttrValueList,l=>(_(),$(T,{key:l.id,label:l.saleAttrValueName,value:`${t.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(d,{label:"图片名称"},{default:a(()=>[e(G,{border:"",data:I.value,ref_key:"imageTable",ref:P},{default:a(()=>[e(p,{type:"selection",width:"80px",align:"center"}),e(p,{label:"图片"},{default:a(({row:t})=>[j("img",{src:t.imgUrl,style:{width:"100px",height:"100px"}},null,8,Ie)]),_:1}),e(p,{label:"名称",prop:"imgName"}),e(p,{label:"操作"},{default:a(({row:t})=>[e(g,{type:"warning",onClick:l=>U(t)},{default:a(()=>o[4]||(o[4]=[q("设置默认")])),_:2,__:[4]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(d,null,{default:a(()=>[e(g,{type:"primary",onClick:y},{default:a(()=>o[5]||(o[5]=[q("保存")])),_:1,__:[5]}),e(g,{type:"default",onClick:E},{default:a(()=>o[6]||(o[6]=[q("取消")])),_:1,__:[6]})]),_:1})]),_:1})])}}}),Ue={class:"demo-pagination-block"},xe=["src"],he=Y({__name:"index",setup(f){const S=_e(),L=i(!1);let P=i([]);const D=i(),A=i();let I=i([]),s=i(0),E=i(!0),k=i(0),U=i(1),y=i(3);fe(()=>S.c3Id,()=>{S.c3Id&&r()});const r=async()=>{const p=await ge(U.value,y.value,S.c3Id);p.code===200&&(I.value=p.data.records,s.value=p.data.total)},v=()=>{U.value=1,S.c3Id&&r()},o=()=>{k.value=1,A.value.initAddSpuData(S.c3Id)},c=p=>{k.value=1,A.value.initHasSpuData(p)},d=p=>{ye(p.id).then(g=>{g.code===200?(N.success("删除成功"),r()):N.error("删除失败")})},T=p=>{k.value=2,D.value.initSkuData(S.c1Id,S.c2Id,p)},H=p=>{Se(p.id).then(g=>{P.value=g.data,L.value=!0})},z=p=>{k.value=p,r()};return(p,g)=>{const G=u("Category"),t=u("el-button"),l=u("el-table-column"),m=u("el-popconfirm"),V=u("el-table"),K=u("el-pagination"),w=u("el-dialog"),Q=u("el-card");return _(),h("div",null,[e(G,{scene:x(E)},null,8,["scene"]),e(Q,{class:"box-card",style:{margin:"10px 0"}},{default:a(()=>[W(j("div",null,[e(t,{type:"primary",size:"default",icon:"Plus",disabled:x(S).c3Id==="",onClick:o},{default:a(()=>g[3]||(g[3]=[q("添加SPU")])),_:1,__:[3]},8,["disabled"]),e(V,{style:{margin:"10px 0"},border:"",data:x(I)},{default:a(()=>[e(l,{label:"序号",width:"80px",align:"center",type:"index"}),e(l,{prop:"spuName",label:"SPU名称"}),e(l,{prop:"description",label:"SPU描述"}),e(l,{label:"操作"},{default:a(({row:b})=>[e(t,{type:"info",size:"default",icon:"Plus",title:"添加SKU",onClick:M=>T(b)},null,8,["onClick"]),e(t,{type:"warning",size:"default",icon:"Edit",title:"修改SPU",onClick:M=>c(b)},null,8,["onClick"]),e(t,{type:"primary",size:"default",icon:"View",title:"查看SPU",onClick:M=>H(b)},null,8,["onClick"]),e(m,{title:`您确定删除${b.spuName}吗?`,width:"200px",onConfirm:M=>d(b)},{reference:a(()=>[e(t,{type:"danger",size:"default",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),j("div",Ue,[e(K,{"current-page":x(U),"onUpdate:currentPage":g[0]||(g[0]=b=>Z(U)?U.value=b:U=b),"page-size":x(y),"onUpdate:pageSize":g[1]||(g[1]=b=>Z(y)?y.value=b:y=b),"page-sizes":[3,5,7,9],disabled:!1,background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:x(s),onCurrentChange:r,onSizeChange:v},null,8,["current-page","page-size","total"])])],512),[[X,x(k)===0]]),W(e(ke,{onChangeScene:z,ref_key:"SpuForm",ref:A},null,512),[[X,x(k)===1]]),W(e(Ae,{onChangeScene:z,ref_key:"SkuForm",ref:D},null,512),[[X,x(k)===2]]),e(w,{title:"SKU列表",modelValue:L.value,"onUpdate:modelValue":g[2]||(g[2]=b=>L.value=b)},{default:a(()=>[e(V,{border:"",data:x(P)},{default:a(()=>[e(l,{prop:"skuName",label:"SKU名称"}),e(l,{prop:"price",label:"SKU价格"}),e(l,{prop:"weight",label:"SKU重量"}),e(l,{label:"SKU图片"},{default:a(({row:b})=>[j("img",{src:b.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,xe)]),_:1}),e(l,{prop:"skuDesc",label:"SKU描述"})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{he as default};
