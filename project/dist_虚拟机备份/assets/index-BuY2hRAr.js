import{I as w,d as ie,u as me,r as d,a as pe,B as fe,e as p,c as F,o as R,b as l,w as o,k as i,i as k,h as m,q as O,m as ve,J as S,t as M,F as ge,p as ce,K as s,A as J,_ as _e}from"./index-DuhZuMDA.js";import{u as be}from"./setting-CDSJT56p.js";const we=(n,q,V)=>w.get(`/admin/acl/user/${n}/${q}?username=${V}`),ye=n=>n.id?w.put("/admin/acl/user/update",n):w.post("/admin/acl/user/save",n),Ve=n=>w.get(`/admin/acl/user/toAssign/${n}`),Ce=n=>w.post("/admin/acl/user/doAssignRole",n),ke=n=>w.delete(`/admin/acl/user/remove/${n}`),Ue=n=>w.delete("/admin/acl/user/batchRemove",{data:n}),he={class:"demo-pagination-block"},xe={style:{float:"right","margin-top":"20px"}},Re={style:{float:"right","margin-top":"20px"}},Se=ie({__name:"index",setup(n){let q=me();const V=d(1),N=d(5),I=d(0),L=d([]);let v=d(!1),g=d(!1),r=pe({name:"",password:"",username:""});const U=d(),_=()=>{we(V.value,N.value,x.value).then(t=>{I.value=t.data.total,L.value=t.data.records}).catch(t=>{s.error("获取用户信息列表失败，"+t.message)})};fe(()=>{_()});const $=d(!1),K=t=>{v.value=!0,r.id=t.id,r.name=t.name,r.password=t.password,r.username=t.username,$.value=r.username===q.username},G=()=>{Object.assign(r,{id:"",name:"",password:"",username:""}),$.value=!1,v.value=!0},H=()=>{U.value.validate().then(()=>{v.value=!1,ye(r).then(t=>{t.code===200?(s.success("保存成功"),_(),$.value&&window.location.reload()):s.error("保存失败，"+t.message)}).catch(t=>{s.error("保存失败，"+t.message)})}).catch(()=>{s.error("请检查输入信息是否正确")})},Q={username:[{required:!0,trigger:"blur",validator:(t,e,u)=>{e.trim().length>=3&&e.trim().length<=15?u():u(new Error("用户名长度在 3 到 15 个字母"))}}],name:[{required:!0,trigger:"blur",validator:(t,e,u)=>{e.trim().length>=3&&e.trim().length<=10?u():u(new Error("用户昵称长度在 3 到 10 个字符"))}}],password:[{required:!0,trigger:"blur",validator:(t,e,u)=>{e.trim().length>=5&&e.trim().length<=20?u():u(new Error("用户密码长度在 5 到 20 个字符"))}}]},W=()=>{r.id="",r.name="",r.password="",r.username="",J(()=>{U.value.resetFields()})},C=d([]),y=d([]),X=t=>{Object.assign(r,t),Ve(t.id).then(e=>{e.code===200&&(C.value=e.data.allRolesList,y.value=e.data.assignRoles,g.value=!0,J(()=>{h.value=!!y.value.length}))}).catch(e=>{s.error("获取用户角色列表失败，"+e.message)})},Y=()=>{const t={userId:r.id,roleIdList:y.value.map(e=>e.id)};Ce(t).then(e=>{e.code===200?(s.success("保存成功"),g.value=!1,_()):s.error("保存失败，"+e.message)}).catch(e=>{s.error("保存失败，"+e.message)})},z=d(!1),h=d(!0),Z=t=>{y.value=t?C.value:[],h.value=!1},ee=t=>{const e=t.length;z.value=e===C.value.length,h.value=e>0&&e<C.value.length},le=async t=>{ke(t.id).then(e=>{e.code===200?(s.success("删除成功"),_()):s.error("删除失败，"+e.message)}).catch(e=>{s.error("删除失败，"+e.message)})},A=d([]),te=t=>{A.value=t.map(e=>e.id)},ae=()=>{Ue(A.value).then(t=>{t.code===200?(_(),s.success("删除成功")):s.error("删除失败，"+t.message)}).catch(t=>{s.error("删除失败，"+t.message)})},x=d(""),oe=()=>{_()},E=be(),re=()=>{E.refresh=!E.refresh};return(t,e)=>{const u=p("el-input"),b=p("el-form-item"),f=p("el-button"),D=p("el-form"),B=p("el-card"),c=p("el-table-column"),se=p("el-popconfirm"),ne=p("el-table"),ue=p("el-pagination"),P=p("el-drawer"),T=p("el-checkbox"),de=p("el-checkbox-group");return R(),F("div",null,[l(B,null,{default:o(()=>[l(D,{inline:"",class:"form"},{default:o(()=>[l(b,{label:"用户名"},{default:o(()=>[l(u,{placeholder:"请输入用户名",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a)},null,8,["modelValue"])]),_:1}),l(b,null,{default:o(()=>[l(f,{type:"primary",onClick:oe,disabled:!x.value},{default:o(()=>e[13]||(e[13]=[i("搜索")])),_:1,__:[13]},8,["disabled"]),l(f,{type:"primary",onClick:re},{default:o(()=>e[14]||(e[14]=[i("重置")])),_:1,__:[14]})]),_:1})]),_:1})]),_:1}),l(B,{style:{margin:"10px 0"}},{default:o(()=>[l(f,{type:"primary",onClick:G},{default:o(()=>e[15]||(e[15]=[i("新增用户")])),_:1,__:[15]}),l(f,{type:"danger",disabled:!A.value.length,onClick:ae},{default:o(()=>e[16]||(e[16]=[i("批量删除")])),_:1,__:[16]},8,["disabled"]),l(ne,{border:"",data:L.value,onSelectionChange:te,style:{margin:"10px 0"}},{default:o(()=>[l(c,{type:"selection"}),l(c,{label:"#",type:"index"}),l(c,{label:"ID",prop:"id","show-overflow-tooltip":""}),l(c,{label:"用户名",prop:"username","show-overflow-tooltip":""}),l(c,{label:"用户昵称",prop:"name","show-overflow-tooltip":""}),l(c,{label:"用户角色",prop:"roleName","show-overflow-tooltip":""}),l(c,{label:"创建时间",prop:"createTime","show-overflow-tooltip":""}),l(c,{label:"更新时间",prop:"updateTime","show-overflow-tooltip":""}),l(c,{label:"操作",width:"350px"},{default:o(({row:a})=>[l(f,{type:"primary",icon:"User",onClick:j=>X(a)},{default:o(()=>e[17]||(e[17]=[i("分配角色")])),_:2,__:[17]},1032,["onClick"]),l(f,{type:"warning",icon:"Edit",onClick:j=>K(a)},{default:o(()=>e[18]||(e[18]=[i("编辑")])),_:2,__:[18]},1032,["onClick"]),l(se,{title:`您确定删除用户${a.username}吗?`,width:"260px",onConfirm:j=>le(a)},{reference:o(()=>[l(f,{type:"danger",size:"default",icon:"Delete",title:"删除用户"},{default:o(()=>e[19]||(e[19]=[i("删除")])),_:1,__:[19]})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),k("div",he,[l(ue,{"current-page":V.value,"onUpdate:currentPage":e[1]||(e[1]=a=>V.value=a),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=a=>N.value=a),"page-sizes":[5,7,9,11],disabled:!1,background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:I.value,onCurrentChange:_,onSizeChange:_},null,8,["current-page","page-size","total"])])]),_:1}),l(P,{modelValue:m(v),"onUpdate:modelValue":e[7]||(e[7]=a=>S(v)?v.value=a:v=a),onClosed:W},{header:o(()=>[k("h2",null,M(m(r).id?"编辑用户信息":"新增用户"),1)]),default:o(()=>[l(D,{model:m(r),ref_key:"formref",ref:U,rules:Q,"label-width":"80px","label-position":"left"},{default:o(()=>[l(b,{label:"用户名",prop:"username"},{default:o(()=>[l(u,{placeholder:"请输入用户名",modelValue:m(r).username,"onUpdate:modelValue":e[3]||(e[3]=a=>m(r).username=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户昵称",prop:"name"},{default:o(()=>[l(u,{placeholder:"请输入用户昵称",modelValue:m(r).name,"onUpdate:modelValue":e[4]||(e[4]=a=>m(r).name=a)},null,8,["modelValue"])]),_:1}),m(r).id?ve("",!0):(R(),O(b,{key:0,label:"用户密码",prop:"password"},{default:o(()=>[l(u,{placeholder:"请输入用户密码",modelValue:m(r).password,"onUpdate:modelValue":e[5]||(e[5]=a=>m(r).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"]),k("div",xe,[l(f,{type:"default",onClick:e[6]||(e[6]=a=>S(v)?v.value=!1:v=!1)},{default:o(()=>e[20]||(e[20]=[i("取消")])),_:1,__:[20]}),l(f,{type:"primary",onClick:H},{default:o(()=>e[21]||(e[21]=[i("保存")])),_:1,__:[21]})])]),_:1},8,["modelValue"]),l(P,{modelValue:m(g),"onUpdate:modelValue":e[12]||(e[12]=a=>S(g)?g.value=a:g=a)},{header:o(()=>e[22]||(e[22]=[k("h2",null,"分配用户角色",-1)])),default:o(()=>[l(D,{ref_key:"formref",ref:U,"label-width":"80px","label-position":"left"},{default:o(()=>[l(b,{label:"用户名",prop:"username"},{default:o(()=>[l(u,{modelValue:m(r).username,"onUpdate:modelValue":e[8]||(e[8]=a=>m(r).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),l(b,{label:"职位列表"},{default:o(()=>[l(T,{style:{width:"100%"},modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=a=>z.value=a),indeterminate:h.value,onChange:Z},{default:o(()=>e[23]||(e[23]=[i("全选")])),_:1,__:[23]},8,["modelValue","indeterminate"]),l(de,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value=a),onChange:ee},{default:o(()=>[(R(!0),F(ge,null,ce(C.value,a=>(R(),O(T,{key:a.id,label:a,value:a},{default:o(()=>[i(M(a.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512),k("div",Re,[l(f,{type:"default",onClick:e[11]||(e[11]=a=>S(g)?g.value=!1:g=!1)},{default:o(()=>e[24]||(e[24]=[i("取消")])),_:1,__:[24]}),l(f,{type:"primary",onClick:Y},{default:o(()=>e[25]||(e[25]=[i("保存")])),_:1,__:[25]})])]),_:1},8,["modelValue"])])}}}),De=_e(Se,[["__scopeId","data-v-76470061"]]);export{De as default};
