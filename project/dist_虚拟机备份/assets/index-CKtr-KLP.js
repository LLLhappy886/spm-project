import{I as b,d as X,r as m,B as Y,a as Z,e as u,c as ee,o as le,b as l,w as o,k as p,i as N,K as d,_ as oe}from"./index-DuhZuMDA.js";import{u as te}from"./setting-CDSJT56p.js";const ae=(i,f,k)=>b.get(`/admin/acl/role/${i}/${f}?roleName=${k}`),re=i=>i.id?b.put("/admin/acl/role/update",i):b.post("/admin/acl/role/save",i),ne=i=>b.get(`/admin/acl/permission/toAssign/${i}`),se=(i,f)=>b.post(`/admin/acl/permission/doAssign?roleId=${i}&permissionId=${f}`),de=i=>b.delete(`/admin/acl/role/remove/${i}`),ie={class:"demo-pagination-block"},ue={style:{float:"right","margin-top":"20px"}},me=X({__name:"index",setup(i){const f=m(1),k=m(5),$=m(0),C=m(""),R=m([]),v=()=>{ae(f.value,k.value,C.value).then(a=>{$.value=a.data.total,R.value=a.data.records}).catch(a=>{d.error("获取用户信息列表失败，"+a.message)})};Y(()=>{v()});const q=()=>{v()},h=te(),I=()=>{h.refresh=!h.refresh},_=m(!1),r=Z({id:"",roleName:"",createTime:"",updateTime:"",remark:""}),j=()=>{Object.assign(r,{id:"",roleName:"",createTime:"",updateTime:"",remark:""})},A=a=>{Object.assign(r,a),_.value=!0},B={roleName:[{required:!0,trigger:"blur",validator:(a,e,n)=>{e.trim().length>=2&&e.trim().length<=20?n():n(new Error("角色名称长度必须在2-20个字符之间"))}}]},U=m(),E=()=>{U.value.validate().then(()=>{re(r).then(a=>{a.code===200?(d.success(r.id?"修改角色成功":"添加角色成功"),_.value=!1,v()):d.error("操作失败，"+a.message)}).catch(a=>{d.error("操作失败，"+a.message)})}).catch(()=>{d.error("请检查输入内容是否规范")})},y=m(!1),V=m([]),O={children:"children",label:"name"},P=m([]),D=a=>{Object.assign(r,a),ne(a.id).then(e=>{e.code===200?(V.value=e.data,P.value=T(V.value,[]),y.value=!0):d.error("获取权限列表失败，"+e.message)}).catch(e=>{d.error("获取权限列表失败，"+e.message)})},T=(a,e)=>(a.forEach(n=>{n.children?T(n.children,e):n.select&&n.level===4&&e.push(n.id)}),e),w=m(),K=()=>{const a=r.id;let e=w.value.getCheckedKeys(!0),n=w.value.getHalfCheckedKeys(),c=e.concat(n);se(a,c).then(s=>{s.code===200?(d.success("分配权限成功"),y.value=!1):d.error("分配权限失败，"+s.message)}).catch(s=>{d.error("分配权限失败，"+s.message)})},L=()=>{Object.assign(r,{id:"",roleName:"",createTime:"",updateTime:"",remark:""}),V.value=[]},H=a=>{de(a.id).then(e=>{e.code===200?(d.success("删除角色成功"),v()):d.error("删除角色失败，"+e.message)}).catch(e=>{d.error("删除角色失败，"+e.message)})};return(a,e)=>{const n=u("el-input"),c=u("el-form-item"),s=u("el-button"),x=u("el-form"),z=u("el-card"),g=u("el-table-column"),M=u("el-popconfirm"),F=u("el-table"),G=u("el-pagination"),J=u("el-dialog"),Q=u("el-tree"),W=u("el-drawer");return le(),ee("div",null,[l(z,null,{default:o(()=>[l(x,{inline:"",class:"form"},{default:o(()=>[l(c,{label:"角色名称"},{default:o(()=>[l(n,{placeholder:"请输入角色名称",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t)},null,8,["modelValue"])]),_:1}),l(c,null,{default:o(()=>[l(s,{type:"primary",disabled:!C.value,onClick:q},{default:o(()=>e[11]||(e[11]=[p("搜索")])),_:1,__:[11]},8,["disabled"]),l(s,{type:"primary",onClick:I},{default:o(()=>e[12]||(e[12]=[p("重置")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1}),l(z,{style:{margin:"10px 0"}},{default:o(()=>[l(s,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=t=>_.value=!0)},{default:o(()=>e[13]||(e[13]=[p("添加角色")])),_:1,__:[13]}),l(F,{border:"",data:R.value,style:{margin:"10px 0"}},{default:o(()=>[l(g,{label:"#",type:"index"}),l(g,{label:"ID",prop:"id","show-overflow-tooltip":""}),l(g,{label:"角色名称",prop:"roleName","show-overflow-tooltip":""}),l(g,{label:"创建时间",prop:"createTime","show-overflow-tooltip":""}),l(g,{label:"更新时间",prop:"updateTime","show-overflow-tooltip":""}),l(g,{label:"操作",width:"350px"},{default:o(({row:t})=>[l(s,{type:"primary",icon:"User",onClick:S=>D(t)},{default:o(()=>e[14]||(e[14]=[p("分配权限")])),_:2,__:[14]},1032,["onClick"]),l(s,{type:"warning",icon:"Edit",onClick:S=>A(t)},{default:o(()=>e[15]||(e[15]=[p("编辑")])),_:2,__:[15]},1032,["onClick"]),l(M,{title:`您确定删除角色${t.roleName}吗?`,width:"260px",onConfirm:S=>H(t)},{reference:o(()=>[l(s,{type:"danger",size:"default",icon:"Delete",title:"删除角色"},{default:o(()=>e[16]||(e[16]=[p("删除")])),_:1,__:[16]})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),N("div",ie,[l(G,{"current-page":f.value,"onUpdate:currentPage":e[2]||(e[2]=t=>f.value=t),"page-size":k.value,"onUpdate:pageSize":e[3]||(e[3]=t=>k.value=t),"page-sizes":[5,10,15,20],disabled:!1,background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:$.value,onCurrentChange:v,onSizeChange:v},null,8,["current-page","page-size","total"])])]),_:1}),l(J,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),title:r.id?"修改角色":"添加角色",onClosed:j},{footer:o(()=>[l(s,{onClick:e[6]||(e[6]=t=>_.value=!1)},{default:o(()=>e[17]||(e[17]=[p("取消")])),_:1,__:[17]}),l(s,{type:"primary",onClick:E},{default:o(()=>e[18]||(e[18]=[p("确定")])),_:1,__:[18]})]),default:o(()=>[l(x,{ref_key:"form",ref:U,model:r,rules:B,style:{width:"80%"},"label-width":"auto"},{default:o(()=>[l(c,{label:"角色名称",prop:"roleName"},{default:o(()=>[l(n,{placeholder:"请输入角色名称",modelValue:r.roleName,"onUpdate:modelValue":e[4]||(e[4]=t=>r.roleName=t)},null,8,["modelValue"])]),_:1}),l(c,{label:"备注",prop:"remark"},{default:o(()=>[l(n,{placeholder:"请输入角色名称",modelValue:r.remark,"onUpdate:modelValue":e[5]||(e[5]=t=>r.remark=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=t=>y.value=t),onClosed:L},{header:o(()=>e[19]||(e[19]=[N("h2",null,"分配角色权限",-1)])),default:o(()=>[l(x,{model:r,"label-width":"80px","label-position":"left"},{default:o(()=>[l(c,{label:"角色名",prop:"roleName"},{default:o(()=>[l(n,{disabled:!0,modelValue:r.roleName,"onUpdate:modelValue":e[8]||(e[8]=t=>r.roleName=t)},null,8,["modelValue"])]),_:1}),l(Q,{ref_key:"tree",ref:w,style:{"max-width":"600px"},data:V.value,"show-checkbox":"","node-key":"id","default-expand-all":!0,"default-checked-keys":P.value,props:O},null,8,["data","default-checked-keys"])]),_:1},8,["model"]),N("div",ue,[l(s,{type:"default",onClick:e[9]||(e[9]=t=>y.value=!1)},{default:o(()=>e[20]||(e[20]=[p("取消")])),_:1,__:[20]}),l(s,{type:"primary",onClick:K},{default:o(()=>e[21]||(e[21]=[p("保存")])),_:1,__:[21]})])]),_:1},8,["modelValue"])])}}}),ve=oe(me,[["__scopeId","data-v-8dd299dd"]]);export{ve as default};
