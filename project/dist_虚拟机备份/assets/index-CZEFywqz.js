import{d as M,a as Q,r as C,N as G,z as H,O as R,e as o,c as V,o as y,b as e,w as s,n as h,i as A,h as I,k as p,F as W,p as X,q as z,t as B,v as O,A as S,P as Y,K as c,Q as Z}from"./index-DuhZuMDA.js";const ee=["onClick"],le=M({__name:"index",setup(te){const l=Q({attrName:"",categoryId:"",categoryLevel:3,attrValueList:[]});let b=C([]);const m=C(!0),f=()=>{m.value=!m.value},_=G(),g=C([]);H(()=>_.c3Id,()=>{g.value=[],_.c3Id!==""&&N()});const N=async()=>{const{c1Id:a,c2Id:t,c3Id:v}=_;let r=await R(a,t,v);r.code===200&&(g.value=r.data)},D=()=>{Object.assign(l,{attrName:"",categoryId:_.c3Id,categoryLevel:3,attrValueList:[]}),f()},q=()=>{l.attrValueList.push({valueName:"",flag:!0}),S(()=>{b.value[l.attrValueList.length-1].focus()})},E=a=>{f(),Object.assign(l,JSON.parse(JSON.stringify(a)))},P=a=>{g.value.splice(g.value.findIndex(t=>t.id===a),1),Y(a).then(t=>{t.code===200?(c({type:"success",message:"删除成功"}),N()):c({type:"error",message:"删除失败"})})},U=async()=>{if(l.attrValueList.length===0&&l.attrName===""){c({type:"error",message:"属性值不能为空"});return}(await Z(l)).code===200?(f(),c({type:"success",message:l.id?"修改成功":"添加成功"}),N()):c({type:"error",message:l.id?"修改失败":"添加失败"})},k=a=>{a.flag=!a.flag},$=(a,t)=>{k(a),S(()=>{b.value[t].focus()})},j=(a,t)=>{if(a.valueName===""){c({type:"error",message:"属性值名称不能为空"});return}l.attrValueList.find((r,i)=>{if(r.valueName===a.valueName&&i!==t)return c({type:"error",message:"属性值名称不能重复"}),!0})||k(a)};return(a,t)=>{const v=o("Category"),r=o("el-button"),i=o("el-table-column"),w=o("el-tag"),F=o("el-popconfirm"),x=o("el-table"),L=o("el-input"),J=o("el-form-item"),T=o("el-form"),K=o("el-card");return y(),V("div",null,[e(v,{scene:m.value},null,8,["scene"]),e(K,{style:{margin:"10px 0"}},{default:s(()=>[h(A("div",null,[e(r,{type:"primary",size:"default",icon:"Plus",disabled:I(_).c3Id==="",onClick:D},{default:s(()=>t[1]||(t[1]=[p("添加属性")])),_:1,__:[1]},8,["disabled"]),e(x,{border:"",style:{margin:"10px 0"},data:g.value},{default:s(()=>[e(i,{label:"序号",type:"index",align:"center",width:"80px"}),e(i,{label:"属性名称",width:"150px",prop:"attrName"}),e(i,{label:"属性值名称"},{default:s(({row:n})=>[(y(!0),V(W,null,X(n.attrValueList,(d,u)=>(y(),z(w,{key:u,type:u===0?"primary":"success",style:{"margin-right":"5px"}},{default:s(()=>[p(B(d.valueName)+">",1)]),_:2},1032,["type"]))),128))]),_:1}),e(i,{label:"操作",width:"150px"},{default:s(({row:n})=>[e(r,{type:"primary",size:"default",onClick:d=>E(n),icon:"Edit"},null,8,["onClick"]),e(F,{title:`确认删除${n.attrName}吗？`,onConfirm:d=>P(n.id),width:"200px"},{reference:s(()=>[e(r,{type:"danger",size:"default",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[O,m.value]]),h(A("div",null,[e(T,{inline:""},{default:s(()=>[e(J,{label:"属性名称"},{default:s(()=>[e(L,{placeholder:"请输入属性名称",modelValue:l.attrName,"onUpdate:modelValue":t[0]||(t[0]=n=>l.attrName=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{type:"primary",size:"default",icon:"Plus",disabled:l.attrName==="",onClick:q},{default:s(()=>t[2]||(t[2]=[p("添加属性值")])),_:1,__:[2]},8,["disabled"]),e(r,{type:"default",size:"default",onClick:f},{default:s(()=>t[3]||(t[3]=[p("取消")])),_:1,__:[3]}),e(x,{border:"",style:{margin:"10px 0"},data:l.attrValueList},{default:s(()=>[e(i,{width:"80px",label:"序号",type:"index",align:"center"}),e(i,{label:"属性值名称"},{default:s(({row:n,$index:d})=>[n.flag?(y(),z(L,{key:0,ref:u=>I(b)[d]=u,onBlur:u=>j(n,d),placeholder:"请输入属性值名称",modelValue:n.valueName,"onUpdate:modelValue":u=>n.valueName=u},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(y(),V("div",{key:1,onClick:u=>$(n,d)},B(n.valueName),9,ee))]),_:1}),e(i,{label:"操作"},{default:s(({$index:n})=>[e(r,{type:"danger",size:"default",onClick:d=>l.attrValueList.splice(n,1),icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(r,{type:"primary",size:"default",onClick:U,disabled:l.attrValueList.length===0},{default:s(()=>t[4]||(t[4]=[p("保存")])),_:1,__:[4]},8,["disabled"]),e(r,{type:"default",size:"default",onClick:f},{default:s(()=>t[5]||(t[5]=[p("取消")])),_:1,__:[5]})],512),[[O,!m.value]])]),_:1})])}}});export{le as default};
